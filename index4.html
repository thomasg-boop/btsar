<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Pantin – Grand écart + tronc</title>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
</head>

<body>
<a-scene>

<a-video id="video" src="./Epic-BTS3.mp4" scale="5 5 5" position="0 2.54164 -0.37576"></a-video>
  
  <a-entity rotation="0 180 0">
  <!-- LUMIÈRES -->
  <a-entity id="ambientLight" light="type: ambient; color: #ffffff; intensity: 0.6"></a-entity>
  <a-entity id="mainLight" light="type: directional; color: #ffffff; intensity: 0.9" position="1 3 2"></a-entity>

  <!-- SOL -->
  <a-plane rotation="-90 0 0" width="10" height="10" color="#666"></a-plane>

  <!-- CAISSES -->
<a-entity id="boxL">
<a-gltf-model id="ServL" src="./scene.glb" gltf-model="./scene.glb" scale="0.61647 0.59806 1"></a-gltf-model>
    <a-box position="0 0.25 0" width="0.6" height="0.5" depth="0.6" color="#7a4a1f">
    </a-box>
    <a-box id="footL" position="0 0.55 0" width="0.3" height="0.1" depth="0.4" color="#111">
    </a-box>
  </a-entity>

<a-entity id="boxR">
           <a-gltf-model id="ServR" src="./scene.glb" gltf-model="./scene.glb" scale="0.59847 0.60631 1"></a-gltf-model>
    <a-box position="0 0.25 0" width="0.6" height="0.5" depth="0.6" color="#7a4a1f">
    </a-box>
    <a-box id="footR" position="0 0.55 0" width="0.3" height="0.1" depth="0.4" color="#111">
    </a-box>
  </a-entity>

  <!-- PANTIN -->
  <a-entity id="pantin" pantin>

    <!-- pelvis logique -->
    <a-entity id="pelvis"></a-entity>

    <!-- jambes -->
<a-cylinder id="legL" radius="0.08" color="#2563eb" material="color: #000000"> 
<a-gltf-model src="./piedgg.glb" position="0.00814 0.4676 -0.09448" rotation="-1.4335404034173198 -97.08827134271313 8.546238472171359" gltf-model="./piedgg.glb">
    </a-gltf-model>
                 </a-cylinder>
    
<a-cylinder id="legR" radius="0.08" color="#2563eb" material="color: #000000">
    <a-gltf-model src="./piedd.glb" position="0.29359 -0.46273 0.28355" rotation="-0.3781521447863434 82.07906894146608 -4.904518726319846" gltf-model="./piedd.glb">
    </a-gltf-model>
               </a-cylinder>

    <!-- tronc -->
    <a-cylinder id="trunk" radius="0.12" height="0.4" color="#ef4444">
<a-gltf-model id="quoi ma gueule" src="./torp.glb" position="0.00095 -0.65063 -0.0162" gltf-model="./torp.glb" rotation="0 180 0">
    </a-gltf-model>
    </a-cylinder>

  </a-entity>
</a-entity>
  <!-- CAMÉRA -->
<a-camera position="0.04319018943147896 -0.38939 -2.0633013401174636" rotation="15.584452027558367 1.145915590261655 0"></a-camera>
</a-scene>

<script>
/* =========================================================
   PARAMÈTRES
   ========================================================= */
const boxWidth  = 0.6;
const legLength = 1.2;
const minSpread = boxWidth;
const maxSpread = 2 * legLength;

let spread = 1.2;
let spreading = false;

/* =========================================================
   INTERACTION CLIC
   ========================================================= */
window.addEventListener("mousedown", () => spreading = true);
window.addEventListener("mouseup",   () => spreading = false);

/* =========================================================
   CAISSES + LUMIÈRE
   ========================================================= */
AFRAME.registerComponent("box-spread", {
  tick() {
    const speed = 0.02;
    spread += spreading ? speed : -speed;
    spread = Math.min(Math.max(spread, minSpread), maxSpread);

    // position des caisses
    document.querySelector("#boxL").object3D.position.x = -spread / 2;
    document.querySelector("#boxR").object3D.position.x =  spread / 2;

    // ---- LUMIÈRE DYNAMIQUE ----
    const t = (spread - minSpread) / (maxSpread - minSpread); // 0 → 1
    const r = 1.0;
    const g = 1.0 - t;
    const b = 1.0 - t;
    const color = `rgb(${Math.floor(r*255)}, ${Math.floor(g*255)}, ${Math.floor(b*255)})`;

    document.querySelector("#ambientLight").setAttribute("light", "color", color);
    document.querySelector("#mainLight").setAttribute("light", "color", color);
  }
});
document.querySelector("a-scene").setAttribute("box-spread", "");

/* =========================================================
   PANTIN GÉOMÉTRIQUE
   ========================================================= */
AFRAME.registerComponent("pantin", {
  tick() {
    const footL = document.querySelector("#footL").object3D.getWorldPosition(new THREE.Vector3());
    const footR = document.querySelector("#footR").object3D.getWorldPosition(new THREE.Vector3());

    const d = footL.distanceTo(footR);
    const half = d / 2;

    let pelvisY;
    if (d >= 2 * legLength) {
      pelvisY = footL.y;
    } else {
      pelvisY = footL.y + Math.sqrt(legLength * legLength - half * half);
    }

    const pelvisX = (footL.x + footR.x) / 2;
    const pelvis = document.querySelector("#pelvis").object3D;
    pelvis.position.set(pelvisX, pelvisY, 0);

    // jambes
    connectLeg("#legL", footL, pelvis.position);
    connectLeg("#legR", footR, pelvis.position);

    // tronc : centré sur pelvis
    const trunk = document.querySelector("#trunk").object3D;
    const trunkHeight = 0.8;
    trunk.position.set(pelvisX, pelvisY + trunkHeight / 2, 0);
    trunk.rotation.set(0,0,0); // cylindres verticaux
  }
});

/* =========================================================
   JAMBE = CYLINDRE ENTRE DEUX POINTS
   ========================================================= */
function connectLeg(selector, foot, pelvis) {
  const leg = document.querySelector(selector).object3D;
  const mid = foot.clone().add(pelvis).multiplyScalar(0.5);
  const length = foot.distanceTo(pelvis);
  leg.position.copy(mid);
  leg.scale.set(1, length, 1);
  leg.lookAt(pelvis);
  leg.rotateX(Math.PI / 2);
}
</script>

</body>
</html>



<!--         
<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  </head>

  <body>
 
    <a-scene>
<a-video id="video" src="./Epic-BTS3.mp4" position="-0.08939 1.86922 -4.46008" width="1" height="0.6" scale="4.81604 7.0769 1"></a-video>

<a-entity id="pas epic" position="-2.99582 0 0">
<!--<a-entity id="copter" position="0 0 0" animation="dur: 1000; dir: alternate; easing: linear; loop: true; property: position; to: 0 10 0">
<a-entity id="boris" position="-0.357 0.782 -0.267" rotation="0 0 0" animation="dur: 500; easing: linear; loop: true; property: rotation; to: 0 360 0">
 <a-gltf-model id="jambe droite" src="./piedd.glb" position="-1.36221 1.03042 0.01073" rotation="22.08 0 -86.10982703021142" gltf-model="./piedd.glb">
  </a-gltf-model>
<a-gltf-model id="jambe gauche" src="./piedg.glb" position="0.7242 1.65956 0.29105" rotation="22.08 0 88.01147395225063" gltf-model="./piedg.glb">
  </a-gltf-model>
<a-gltf-model id="tete" src="./rusie.glb" position="-0.35028 1.45 -0.34" rotation="-0.48600000000000004 45.148 5.205" gltf-model="./rusie.glb" scale="1.56977 1.035 1.55">
  </a-gltf-model>">
  </a-gltf-model><a-gltf-model id="quoi ma gueule" src="./torp.glb" position="-0.357 0.782 -0.267" scale="1 0.633 1" gltf-model="./torp.glb">
  </a-gltf-model>
</a-entity>
  </a-entity>
<a-gltf-model id="servante1" src="./scene.glb" gltf-model="./scene.glb" position="-4.59661 0 0" rotation="0 90 0" :position; to: -1.181 0 0"></a-gltf-model>
         
<a-gltf-model id="servante2" src="./scene.glb" gltf-model="./scene.glb" position="-2.07719 0 0" rotation="0 90 0" position; to: 1.181 0 0">&;</a-gltf-model>
        
<a-entity id="epic">
<a-entity id="boris" position="0 0 0" animation="dur: 2500; dir: alternate; easing: easeInOutSine; loop: true; property: position; to: 0 -0.8 0">
     <a-gltf-model id="jambe droite" src="./piedd.glb" gltf-model="./piedgg.glb" position="-0.01532 1.84134 0" rotation="0 0 -42.86384073161517" animation="dir: alternate; dur: 2500; easing: linear; loop: true; property: rotation; to: 0 0 -90"></a-gltf-model>
<a-gltf-model id="jambe gauche" src="./piedg.glb" gltf-model="./jambel.glb" position="0.05506 1.71924 0.02514" rotation="0 0 41.088159268384835" animation="dir: alternate; dur: 2500; easing: linear; loop: true; property: rotation; to: 0 0 90"></a-gltf-model>
         </a-entity>
 <a-gltf-model id="quoi ma gueule" src="./torp.glb" position="-0.06763 1.16339 -0.0162" gltf-model="./torp.glb">
  </a-gltf-model>
<a-gltf-model id="servante1" src="./scene.glb" gltf-model="./scene.glb" position="-1.05594 0 0" rotation="0 90 0" animation="dir: alternate; dur: 2500; easing: linear; loop: true; property: position; to: -1.181 0 0"></a-gltf-model>
 <a-gltf-model id="servante2" src="./scene.glb" gltf-model="./scene.glb" position="1.02503 -0.03257 0" rotation="0 90 0" animation="dir: alternate; dur: 2500; easing: linear; loop: true; property: position; to: 1.181 0 0">&gt;</a-gltf-model>
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>3D interactif avec Three.js</title>
<style>
  body { margin: 0; overflow: hidden; }
  canvas { display: block; }
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.176/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.176/examples/jsm/controls/DragControls.js"></script>

<script>
  // Scène
  const scene = new THREE.Scene();

  // Caméra
  const camera = new THREE.PerspectiveCamera(
    75, window.innerWidth/window.innerHeight, 0.1, 1000
  );
  camera.position.z = 5;

  // Rendu WebGL
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Cube 3D
  const geometry = new THREE.BoxGeometry(1, 1, 1);
  const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
  const cube = new THREE.Mesh(geometry, material);
  scene.add(cube);

  // Controls pour drag (clic & déplacement)
  const controls = new THREE.DragControls([cube], camera, renderer.domElement);

  // Boucle d'animation
  function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  }
  animate();
</script>

</body>
</html>-->
